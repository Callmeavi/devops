name: 07 - Artifacts Demo

# This section defines "WHEN" the workflow should run
on:
    workflow_dispatch: # Allows you to manually trigger this from the GitHub UI button
    push: # Automatically triggers when code is pushed...
        branches:
            - main # ...but ONLY to the 'main' branch

# This section defines "WHAT" should run (the jobs)
jobs:
    # Job 1: Build the code (The Producer)
    build-code:
        name: Build Component
        runs-on: ubuntu-latest # GitHub provides a fresh Linux computer for this job
        steps:
            # Step 1: Download your code onto this Linux computer
            - name: Checkout Code
              uses: actions/checkout@v4

            # Step 2: Simulate creating some files (like you would with 'npm run build')
            - name: Create Build Files
              run: |
                  mkdir build                       # Create a folder name 'build'
                  echo "Main Application Logic" > build/app.js  # Create a dummy JS file
                  echo "Styles" > build/style.css   # Create a dummy CSS file
                  echo "Build Date: $(date)" > build/meta.txt   # Create a file with timestamp
                  echo "Files created successfully."

            # Step 3: Upload the 'build' folder to GitHub storage so other jobs can use it
            - name: Upload Artifact
              uses: actions/upload-artifact@v4
              with:
                  name: my-app-build # We give this "bundle" a specific name to find it later
                  path: build/ # We tell GitHub exactly which folder to upload

    # Job 2: Deploy the code (The Consumer)
    deploy-code:
        name: Deploy Component
        runs-on: ubuntu-latest # This is a DIFFERENT fresh Linux computer (Job 1 is gone)
        needs: build-code # CRITICAL: This tells Job 2 to WAIT until Job 1 finishes successfully
        steps:
            # Step 1: Download the "bundle" we uploaded in Job 1
            - name: Download Artifact
              uses: actions/download-artifact@v4
              with:
                  name: my-app-build # Must match the name used in Upload step
                  path: deployment-folder # Where to put the files on this new computer

            # Step 2: Verify we actually got the files
            - name: Verify Deployment contents
              run: |
                  echo "Listing files received from Build job:"
                  ls -R deployment-folder      # List all files (should see app.js, style.css)
                  echo "------------------------"
                  echo "Reading Meta data:"
                  cat deployment-folder/meta.txt # Read the file content
